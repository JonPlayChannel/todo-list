(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function o(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(n){if(n.ep)return;n.ep=!0;const l=o(n);fetch(n.href,l)}})();const c={toggleComplete:"[data-js-toggle-complete]",todoForm:"[data-js-todo-form]",todoInput:"[data-js-todo-input]",todoList:"[data-js-todo-list]",todoItem:"[data-js-todo-item]",todoItemLabel:"[data-js-todo-item-label]",todoItemCheckbox:"[data-js-todo-item-checkbox]",deleteTaskButton:"[data-js-delete-task-button]",todoFooter:"[data-js-todo-footer]",todoItemsCount:"[data-js-todo-items-count]",todoItemsLabel:"[data-js-todo-items-label]",todoItemsLeft:"[data-js-todo-items-left]",showAllTasksButton:"[data-js-show-all-tasks-button]",showActiveTasksButton:"[data-js-show-active-tasks-button]",showCompletedTasksButton:"[data-js-show-completed-tasks-button]",removeCompletedTasksButton:"[data-js-remove-completed-tasks-button]"},a={visuallyHidden:"visually-hidden",checkbox:"checkbox",checkboxController:"checkbox__controller",checkboxEmulator:"checkbox__emulator",todoItem:"todo__todo-item todo-item",todoItemCheckbox:"todo-item__checkbox",todoItemLabel:"todo-item__label",todoItemLabelCompleted:"todo-item__label--completed",todoItemLabelEditable:"todo-item__label--editable",deleteTaskButton:"todo-item__delete-task-button"},w=document.querySelector(c.todoFooter),q=document.querySelector(c.todoItemsCount),_=document.querySelector(c.todoItemsLabel),D=document.querySelector(c.todoItemsLeft),g=document.querySelector(c.removeCompletedTasksButton),F=t=>{let e=null,o=null;switch(!0){case(t%10===1&&t!==11):e="задача",o="осталась";break;case(t%100===11||t%100===12||t%100===13):e="задач",o="осталось";break;case(t%10===2||t%10===3||t%10===4):e="задачи",o="осталось";break;default:e="задач",o="осталось"}return[e,o]},f=()=>{const t=i(),e=t.filter(({isDone:n})=>!n).length,[o,s]=F(e);q.innerHTML=e,_.innerHTML=o,D.innerHTML=s,N(t),t.length===0&&w.classList.add(a.visuallyHidden)},N=t=>{t.filter(({isDone:o})=>o).length>0?g.classList.remove(a.visuallyHidden):g.classList.add(a.visuallyHidden)},k="snp-todo",i=()=>JSON.parse(localStorage.getItem(k)),O=t=>{const o=[...i()??[],t];localStorage.setItem(k,JSON.stringify(o))},H=t=>{const o=i().filter(s=>s.id!==t);localStorage.setItem(k,JSON.stringify(o))},T=(t,e={})=>{const{isDone:o,label:s}=e,l=i().map(d=>d.id===t?{...d,...o!==void 0&&{isDone:o},...s!==void 0&&{label:s}}:d);localStorage.setItem(k,JSON.stringify(l))},A=()=>{const e=i().filter(o=>!o.isDone);localStorage.setItem(k,JSON.stringify(e))},C=document.querySelector(c.toggleComplete),L=document.querySelector(c.todoList),S=document.querySelector(c.todoInput),M=document.querySelector(c.todoFooter),u="snp-todo-filter",p=t=>{const{id:e,label:o,isDone:s}=t,n=document.createElement("li");n.className=a.todoItem,n.dataset.jsTodoItem="";const l=document.createElement("label");l.classList.add(a.todoItemCheckbox,a.checkbox);const d=document.createElement("input"),y=document.createElement("span");d.className=a.checkboxController,d.type="checkbox",d.id=`${e}`,d.checked=s,d.dataset.jsTodoItemCheckbox="",y.className=a.checkboxEmulator,l.append(d,y);const b=document.createElement("span");b.className=`${a.todoItemLabel} ${s&&a.todoItemLabelCompleted}`,b.textContent=o,b.dataset.jsTodoItemLabel="";const m=document.createElement("button");m.className=a.deleteTaskButton,m.type="button",m.title="Удалить задачу",m.ariaLabel="Удалить задачу",m.dataset.jsDeleteTaskButton="",n.append(l,b,m),L.prepend(n)},B=(t,e)=>{e?t.classList.add(a.todoItemLabelCompleted):t.classList.remove(a.todoItemLabelCompleted)},j=()=>{L.classList.remove(a.visuallyHidden),M.classList.remove(a.visuallyHidden)},r=()=>{const t=sessionStorage.getItem(u)??"none",e=i();if(location.hash=t==="none"?"":t,e!==null){if(j(),L.innerHTML="",t==="none"){e.forEach(o=>p(o));return}if(t==="active"){e.filter(({isDone:s})=>!s).forEach(s=>p(s));return}t==="completed"&&e.filter(({isDone:s})=>s).forEach(s=>p(s))}},J=t=>{t.preventDefault();const e=S.value.trim();if(!e){alert("Пустое имя задачи.");return}const o={id:crypto?.randomUUID()??new Date,label:e,isDone:!1};S.value="",O(o),p(o),f(),L.classList.contains(a.visuallyHidden)&&j(),r(),C.checked=!1},E=()=>{const t=i();let e=!0;for(const o of t)if(!o.isDone){e=!1;break}C.checked=e},P=t=>{const{checked:e}=t,o=document.querySelectorAll(c.todoItemLabel),s=document.querySelectorAll(c.todoItemCheckbox),n=i();o.forEach(l=>B(l,e)),s.forEach(l=>l.checked=e),n.forEach(({id:l})=>{T(l,{isDone:e})}),f(),sessionStorage.setItem(u,e?"completed":"none"),r()},$=t=>{const o=t.closest(c.todoItem).querySelector(c.todoItemLabel),{id:s,checked:n}=t;T(s,{isDone:n}),B(o,n),f(),E(),r()},K=t=>{const o=t.closest(c.todoItem).querySelector(c.todoItemCheckbox)?.id,s=t.innerText;t.innerText=s.replace(/\s+/g," ").trim(),t.contentEditable=!1,t.classList.remove(a.todoItemLabelEditable),T(o,{label:s||""})},U=t=>{const e=t.closest(c.todoItem),o=e.querySelector(c.todoItemCheckbox)?.id,s=e.querySelector(c.todoItemLabel)?.textContent;confirm(`Удалить задачу "${s}"?`)&&(e.remove(),H(o),f(),E())},V=()=>{confirm("Удалить выполненные задачи?")&&(A(),r(),f(),C.checked=!1)},R=document.querySelector(c.todoForm);let h=0,v;const x=400,W=()=>{sessionStorage.setItem(u,"none")},I=(t=null)=>{const e=document.querySelectorAll(c.todoItemLabel),o=s=>{s.classList.remove(a.todoItemLabelEditable),s.contentEditable=!1};if(!t)return e.forEach(s=>o(s));e.forEach(s=>{s!==t&&o(s)})},Y=t=>{I(t);const e=Date.now();if(e-h<x){clearTimeout(v),t.contentEditable=!0,t.classList.add(a.todoItemLabelEditable),h=0;return}h=e,v=setTimeout(()=>{h=0},x)},z=()=>{document.addEventListener("DOMContentLoaded",()=>{W(),r(),f(),E()}),document.addEventListener("click",t=>{const{target:e}=t;if(e.matches(c.toggleComplete))return P(e);if(e.matches(c.todoItemCheckbox))return $(e);if(e.matches(c.todoItemLabel))return Y(e);if(I(),e.matches(c.deleteTaskButton))return U(e);if(e.matches(c.showAllTasksButton))return sessionStorage.setItem(u,"none"),r();if(e.matches(c.showActiveTasksButton))return sessionStorage.setItem(u,"active"),r();if(e.matches(c.showCompletedTasksButton))return sessionStorage.setItem(u,"completed"),r();if(e.matches(c.removeCompletedTasksButton))return V()}),document.addEventListener("blur",t=>{const{target:e}=t;if(e.matches(c.todoItemLabel))return K(e)},!0),document.addEventListener("keydown",t=>{const{code:e}=t;if(e==="Escape")return I()}),R.addEventListener("submit",J)};z();
